Yandex:

При запросе /api/search.xml?from=MOW&to=LON&date1=120212&date2=130512&partner=yandex
Партнер получает XML с массивом элементов variant.
У варианта есть атрибут url со значением вида /api/booking/206f4c#recommendation=amadeus.AB.EEPO.MMMM.9999.AB8395DMEDUS120212-AB8342DUSSTN120212.AB8677STNDUS130512-AB8414DUSDME130512&type=api&partner=yandex
При переходе на него сначала вызывается BookingController#api_booking( query_key ) (рисует обертку и текстовое представление поискового запроса),
а затем BookingController#preliminary_booking( query_key, recommendation, variant_id) (предварительно бронирует, и выясняет недостающие данные о рейсах, чтобы показать их пользователю)
TODO передавать в preliminary_booking еще и marker из входящего урла.


api_redirect:
Momondo(сейчас не используется), возможно другие партнеры (хочет Skyscanner):

запрашивают наше обычное апи (api/search?...), но игнорируют урлы. Создают собственные урлы, вида:
/api/redirection.xml?from=MOW&to=LON&date1=120212&date2=130512&partner=momondo
или на субдомене:
http://api.eviterra/avia/v1/searches?from=MOW&to=LON&date1=120912&partner=scyscanner),
которой соответствует BookingController#api_redirect.
Он сам рисует обертку, а потом как и в первом случае - аяксом вызывается
BookingController#preliminary_booking(query_key)
партнер кладется в куку из урла, инкрементится счетчик api_redirect
(уточнить детали)
маркер (пока) не требуется

Rambler:

Каждый поиск с массивом вариантов кэшируется в монгоидном классе RamblerCache.
Каждую минуту в рамблер уходят десять порций по тридцать(по умолчанию) поисков.
В поисках для каждого варианта лежит своя ссылка вида /api/rambler_booking.xml?#{string},
где string - это строка длиной примерно в 800 символов.
Ссылка ведет на бронирование конкретно этого перелета, она формируется методом uri_for_rambler модуля RamblerApi
и соответствует методу api_rambler_booking в booking_controller.
Этот метод обрабатывает эту огромную строку и формирует ссылку-редирект вида /api/booking/#{search.query_key}#recommendation=#{recommendation}&type=api&partner=#{search.partner}
с помощью метода redirecting_uri модуля RamblerApi.
Редирект происходит на метод api_booking и дальше см.абзац про яндекс (с измененением значения "партнер")
маркер (опять же, пока) не требуется


