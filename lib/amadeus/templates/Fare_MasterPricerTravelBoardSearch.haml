-# https://webservices.amadeus.com/extranet/structures/viewMessageStructure.do?id=1850&serviceVersionId=2028
%numberOfUnit
  %unitNumberDetail
    %numberOfUnits= people_count[:adults] + people_count[:children]
    %typeOfUnit PX
  %unitNumberDetail
    %numberOfUnits 200
    %typeOfUnit RC

%paxReference
  %ptc ADT
  - 1.upto(people_count[:adults]) do |n|
    %traveller
      %ref=n
- if people_count[:children] > 0
  %paxReference
    %ptc CH
    - 1.upto(people_count[:children]) do |n|
      %traveller
        %ref= n+people_count[:adults]
- if people_count[:infants] > 0
  %paxReference
    %ptc INF
    - 1.upto(people_count[:infants]) do |n|
      %traveller
        %ref= n
        %infantIndicator 1

%fareOptions
  %pricingTickInfo
    %pricingTicketing
      %priceType CUC
      %priceType ET
  %feeIdDescription
    %feeId
      %feeType SORT
      %feeIdNumber FEE
  %conversionRate
    %conversionRateDetail
      %currency RUB


%travelFlightInfo
  - if cabin
    %cabinId
      %cabin= cabin
  - if nonstop
    %flightDetail
      %flightType N

-segments.each_with_index do |segment, i|
  %itinerary
    %requestedSegmentRef
      %segRef= i+1
    %departureLocalization
      -if segment.from_iata.length == 3
        %departurePoint
          %locationId= segment.from_iata
      -else
        - Country.main_city_iatas(segment.from_iata).each do |code|
          %depMultiCity
            %locationId= code
    %arrivalLocalization
      -if segment.to_iata.length == 3
        %arrivalPointDetails
          %locationId= segment.to_iata
      -else
        - Country.main_city_iatas(segment.to_iata).each do |code|
          %arrivalMultiCity
            %locationId= code
    %timeDetails
      %firstDateTimeDetail
        %date= segment.date
