<% cache(:action => "index", :action_suffix => @query_key) do %>
<% if @recommendations.present? %>
<div id="offers-options" data-filters='<%= Recommendation.summary(@recommendations, @locations).to_json.gsub("'", '&rsquo;') %>' data-query_key="<%= @query_key %>"></div>

<% unless @search.nearby_cities.empty? %>
<div class="offers-context g-none">
    <h3 class="offers-title">Соседние города</h3>
    <% location_names = ['from', 'to'] %>
    <% @search.form_segments.each_with_index do |segment, s| %>
        <% segment.nearby_cities.each_with_index do |cities, c| %>
        <% unless cities.empty? %>
            <% city = c == 0 ? segment.from_as_object : segment.to_as_object %>
            <p class="cities"><strong><%= city.name_ru %>:</strong> <%= raw cities.map{|c| "<span class=\"city\">#{h c.name}</span>"}.join(', ') %></p>
        <% end %>
        <% end %>
    <% end %>
</div>
<% end %>

<% @recommendations.each do |recommendation| %>
<div class="offer collapsed<%= ' multiple' if recommendation.variants.length > 1 %>" data-summary='<%= recommendation.summary.to_json %>'>
    <% different_cabins = recommendation.cabins_except(@search.cabin) %>
    <% recommendation.variants.each_with_index do |variant, variant_index| %>
        <%= render :partial => 'variant', :locals => {:variant => variant, :recommendation => recommendation, :variant_cabins => different_cabins, :variant_summary => nil} %>
    <% end %>    
    <div class="aux">
        <span style="color:green">
        <%= 'только в беспосадочном запросе.' if recommendation.source == 'right' %>
        <%#= 'в обоих запросах' if recommendation.source.nil? %>
        <%= 'не было в беспосадочном запросе!' if recommendation.source == 'left' && !recommendation.layovers? %>
        </span>
    </div>
</div>    
<% end %>

<% end %>
<% end %>
