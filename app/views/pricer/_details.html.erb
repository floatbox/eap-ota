<div class="os-details" data-flights="<%= flight_codes(segment) %>">
<h4 class="osd-title">
    <strong class="osdt-main"><%= segment_rt ? 'Обратный перелет' : segment_title(segment) %><% if false && common_cabin %> <span class="cabin"><%= human_cabin_ins(common_cabin) %></span><% end %></strong><% if segment.layovers? %> <%= with_layovers(segment) %><% end %>
</h4>
<% segment_cabins = false %>
<% segment.flights.each_with_index do |flight, fcounter| %>
<div class="osd-flight wrap">
    <div class="osd-carrier">
        <img class="osdc-icon" src="<%= flight.operating_carrier.icon_url %>">
    </div>
    <div class="osd-dpt">
        <h5 class="osd-time"><%= fmt_time flight.departure_time %></h5>
        <% if fcounter == 0 %>
            <h6 class="osd-date"><%= date_with_dow flight.departure_date %></h6>
        <% end %>
        <h6 class="osd-action">Вылет <%= raw nbsp(flight.departure.city.case_from) %></h6>
        <ul class="osd-features">
            <li><%= full_airport_and_term(flight.departure, flight.departure_term) %></li>
            <li>Авиакомпания <%= flight.operating_carrier_name %></li>
            <li>Рейс <%= flight.marketing_carrier_iata %>&nbsp;<%= flight.flight_number %> <%= flight.departure.city.name %> — <%= flight.arrival.city.name %></li>
            <li>Самолёт <%= flight.equipment_type_name %></li>
            <li><%= human_duration(flight.duration) %> в&nbsp;пути</li>
            <% if segment_cabins && !common_cabin && segment_cabins[fcounter] %>
                <li><span class="cabin"><%= human_cabin_nom(segment_cabins[fcounter]) %></span></li>
            <% end %>
        </ul>
    </div>
    <div class="osd-arv">
        <h5 class="osd-time"><%= fmt_time flight.arrival_time %></h5>
        <% if fcounter == segment.flights.length - 1 && flight.arrival_date != segment.flights[0].departure_date %>
            <h6 class="osd-date"><%= date_with_dow flight.arrival_date %></h6>
            <h6 class="osd-action">Прилёт <%= nbsp(flight.arrival.city.case_to) %> на&nbsp;следующий день</h6>
        <% else %>
            <h6 class="osd-action">Прилёт <%= nbsp(flight.arrival.city.case_to) %></h6>
        <% end %>
        <ul class="osd-features">
            <li><%= full_airport_and_term(flight.arrival, flight.arrival_term) %></li>
            <% layover = segment.layover_durations[fcounter] %>
            <% unless flight.technical_stop_count.zero? %>
                <li class="osdf-stops">Рейс выполняется <%= with_technical_stops(flight) %></li>
            <% end %>
            <% if layover %>
                <% next_flight = segment.flights[fcounter + 1] %>
                <li<% if layover < 121 %> class="schange"<% elsif layover > 240 %> class="lchange"<% end %>><%= human_duration(layover) %> между рейсами</li>
                <% if next_flight.departure_name != flight.arrival_name %>
                    <li class="diffad">Разные аэропорты прилёта и вылета</li>
                <% elsif next_flight.departure_term != flight.arrival_term %>
                    <li class="diffad">Разные терминалы прилёта и вылета</li>
                <% end %>
            <% end %>
        </ul>
    </div>
</div>
<% end %>
</div>
